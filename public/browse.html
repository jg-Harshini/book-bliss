<!DOCTYPE html>
<html lang="en" ng-app="bookApp">
<head>
  <meta charset="UTF-8" />
  <title>Browse BookBliss</title>

  <!-- AngularJS + ngAnimate -->
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-animate.min.js"></script>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
      background: #d8b4f8;
      color: #3c3c3c;
    }

    .sidebar {
      width: 180px;
      background-color: #9b5de5;
      padding-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      position: fixed;
      height: 100vh;
    }

    .sidebar button {
      background: none;
      border: none;
      cursor: pointer;
      color: white;
      font-size: 20px;
      text-align: center;
      white-space: nowrap;
      width: 100%;
      padding: 10px 0;
    }

    .logo {
      font-size: 1.5rem;
      margin-bottom: 20px;
    }

    .main {
      margin-left: 180px;
      padding: 40px 25px;
      width: calc(100% - 180px);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 25px 40px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(101, 78, 190, 0.15);
    }

    .header {
      padding-bottom: 25px;
      border-bottom: 2px solid #a678f5;
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 2.2rem;
      font-weight: 700;
      color: #5b2db2;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 25px;
      align-items: center;
    }

    .filters label {
      font-weight: 600;
      color: #6a4fbf;
      min-width: 100px;
    }

    .filters select,
    .filters input[type="date"],
    .filters input[type="text"] {
      padding: 10px 14px;
      font-size: 15px;
      border-radius: 8px;
      border: 1.5px solid #c8bff7;
      min-width: 150px;
      outline-offset: 2px;
    }

    .filters select:focus,
    .filters input[type="date"]:focus,
    .filters input[type="text"]:focus {
      border-color: #7a5de8;
      box-shadow: 0 0 8px #7a5de8aa;
    }

    .filters button {
      background: #e0d3f7;
      border: none;
      padding: 0 12px;
      font-weight: 700;
      font-size: 18px;
      border-radius: 6px;
      cursor: pointer;
      color: #5b2db2;
      transition: background-color 0.25s ease;
      height: 38px;
    }

    .filters button:hover {
      background-color: #a678f5;
      color: white;
    }

    .genres {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 40px;
      justify-content: center;
    }

    .genres button {
      background-color: #ede7f6;
      border: 2px solid transparent;
      border-radius: 25px;
      padding: 10px 24px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      color: #5b2db2;
      transition: all 0.3s ease;
      user-select: none;
    }

    .genres button:hover {
      background-color: #bba4f7;
      color: #3f1c7a;
    }

    .genres .active {
      background-color: #7a5de8;
      color: white;
      border-color: #5831a8;
      box-shadow: 0 6px 20px rgba(101, 78, 190, 0.6);
      transform: scale(1.05);
    }

    .book-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 28px;
    }

    .book {
      background-color: #faf7ff;
      padding: 18px 14px 24px;
      border-radius: 18px;
      text-align: center;
      box-shadow: 0 8px 16px rgba(101, 78, 190, 0.15);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: default;
    }

    .book:hover {
      transform: translateY(-6px);
      box-shadow: 0 14px 28px rgba(101, 78, 190, 0.3);
    }

    .book img {
      width: 100%;
      height: 230px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 14px;
      transition: transform 1s ease;
    }

    .book:hover img {
      transform: scale(1.07);
    }

    .book-title {
      font-weight: 700;
      font-size: 1.1rem;
      color: #4a2f9e;
      margin-bottom: 8px;
      min-height: 48px;
    }

    .book-date {
      font-size: 13px;
      color: #7c6dbe;
      font-style: italic;
    }
    

    .fade.ng-enter {
      opacity: 30;
    }

    .fade.ng-enter-active {
      opacity: 15;
      transition: opacity 2s ease-in-out;
    }

    @media (max-width: 720px) {
      .filters label { min-width: 80px; }
      .filters input[type="text"], .filters select, .filters input[type="date"] {
        min-width: 120px;
      }
      .book-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 20px;
      }
    }
  </style>
</head>

<body ng-controller="BrowseController">
  <div class="sidebar">
    <div class="logo">ðŸ“–<span>BookBliss</span></div>
    <button>Browse</button>
    <button>Community</button>
    <button>Settings</button>
    <button>About</button>
    <button>AI</button>
  </div>

  <div class="main">
    <div class="container">
      <div class="header">ðŸ“š Browse BookBliss</div>

   <div class="filters">
<!-- Author Dropdown -->
<select ng-model="selectedAuthor">
  <option value="">All Authors</option>
  <option ng-repeat="author in authors" value="{{author._id}}">
    {{author.name}}
  </option>
</select>

<!-- Year Filter -->
<select ng-model="yearFilter.type">
  <option value="before">Before</option>
  <option value="after">After</option>
</select>
<input type="number" ng-model="yearFilter.year" placeholder="Enter Year">

</div>


      <div class="genres">
        <button 
          ng-repeat="genre in genres" 
          ng-class="{'active': selectedGenre === genre}"
          ng-click="setGenre(genre)">
          {{ genre }}
        </button>
      </div>

      <div class="book-grid">
<book-card class="fade"
  ng-repeat="book in books | filter:masterFilter"
  book="book">
</book-card>

      </div>
    </div>
  </div>

  <!-- AngularJS Application Script -->
<script>
const app = angular.module('bookApp', ['ngAnimate']);

// âœ… Genre Factory
app.factory('GenreFactory', function () {
  return ["Horror", "Thriller", "Mystery", "Fantasy", "Motivation"];
});

// âœ… Book Card Directive
app.directive('bookCard', function () {
  return {
    restrict: 'E',
    scope: { book: '=' },
    template: `
      <div class="book">
        <img ng-src="{{ book.cover }}" alt="Cover of {{ book.title }}">
        <div class="book-title">{{ book.title }}</div>
        <div class="book-date">By {{ book.author.name }} â€¢ {{ book.year }}</div>
        <div class="book-genre">{{ book.genre }}</div>
      </div>
    `
  };
});

// âœ… Controller
app.controller('BrowseController', function ($scope, $http, GenreFactory) {
  $scope.books = [];
  $scope.authors = [];
  $scope.genres = GenreFactory;
  $scope.selectedGenre = "";
  $scope.selectedAuthor = "";
  $scope.yearFilter = { type: 'before', year: "" };

  // Toggle Genre filter
  $scope.setGenre = function (genre) {
    $scope.selectedGenre = ($scope.selectedGenre === genre) ? "" : genre;
  };

  // âœ… Author filter
  $scope.filterByAuthor = function (book) {
    if (!$scope.selectedAuthor) return true;
    return book.author && book.author._id === $scope.selectedAuthor;
  };

  // âœ… Genre filter
  $scope.filterByGenre = function (book) {
    if (!$scope.selectedGenre) return true;
    return book.genre && book.genre.toLowerCase() === $scope.selectedGenre.toLowerCase();
  };

  // âœ… Year filter
  $scope.filterByYear = function (book) {
    if (!$scope.yearFilter.year) return true;
    return $scope.yearFilter.type === 'before'
      ? parseInt(book.year) < parseInt($scope.yearFilter.year)
      : parseInt(book.year) > parseInt($scope.yearFilter.year);
  };

  // âœ… Fetch authors dynamically from Express API
  $http.get("http://localhost:5000/api/authors")
    .then(function (response) {
      $scope.authors = response.data; 
    })
    .catch(err => console.error("Error fetching authors:", err));

  // âœ… Fetch books dynamically from Express API
  $http.get("http://localhost:5000/api/books")
    .then(function (response) {
      $scope.books = response.data; 
    })
    .catch(err => console.error("Error fetching books:", err));
});
</script>


</body>
</html>
